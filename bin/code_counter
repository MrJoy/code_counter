#! /usr/bin/env ruby
require File.expand_path('../../lib/code_counter/engine', __FILE__)

(ENV['ADDITIONAL_SOURCE_DIRECTORIES'] || '').split(',').each do |dir|
  components = dir.split(/\s*:\s*/)
  if components.length > 1
    (label, path) = *components
  else
    label = path = components.first
  end

  path = Pathname.new(path).expand_path.to_s
  if File.directory?(path)
    CodeCounter::Engine.add_path(label, path)
  end
end

user_ignored_globs = (ENV['IGNORE_FILE_GLOBS'] || '').split(',')

puts CodeCounter::Engine.new(user_ignored_globs).to_s
